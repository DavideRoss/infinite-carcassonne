const TILES=[{ids:[1,2,3],edges:["city","city","road","city"]},{ids:[4,5,6,7,8,17,18],edges:["city","field","field","city"]},{ids:[9,10,11,12,13,85],edges:["city","road","road","city"]},{ids:[14,15,16],edges:["field","city","field","city"]},{ids:[19,20,21],edges:["city","field","city","field"]},{ids:[22,23,24,25,26],edges:["city","field","field","field"]},{ids:[27,28,29,86],edges:["city","field","road","road"]},{ids:[30,31,32],edges:["city","road","road","field"]},{ids:[33,34,35],edges:["city","road","road","road"]},{ids:[36,37,38,39],edges:["city","road","field","road"]},{ids:[40,41,42,43,44,45,46,47],edges:["road","field","road","field"]},{ids:[48,49,50,51,52,53,54,55,56,73],edges:["field","field","road","road"]},{ids:[57,58,59,60,84],edges:["field","road","road","road"]},{ids:[61,77],edges:["road","road","road","road"]},{ids:[62,63,64,65],edges:["field","field","field","field"]},{ids:[66,67],edges:["field","field","road","field"]},{ids:[68,80,81,82],edges:["city","city","city","city"]},{ids:[69,70,71,72],edges:["city","city","field","city"]},{ids:[74],edges:["city","field","road","field"]},{ids:[75,90],edges:["road","city","road","city"]},{ids:[76,83],edges:["field","road","field","road"]},{ids:[78],edges:["city","road","field","city"]},{ids:[79],edges:["field","city","field","field"]},{ids:[87],edges:["city","field","road","city"]},{ids:[88,89],edges:["city","field","city","city"]}];(()=>{var a={x:256,y:256},o={x:128,y:128};const e=document.getElementById("main-canvas");e.width=document.body.clientWidth,e.height=document.body.clientHeight;var d=Math.ceil(e.width/o.x),t=Math.ceil(e.height/o.y);const s=e.getContext("2d");var i={x:d,y:t};const l=Array(i.y).fill().map(()=>Array(i.x)),r={x:0,y:0},n={x:0,y:0};var c=()=>s.clearRect(0,0,e.width,e.height),y=(e,d,t,i=0)=>{t={x:d+o.x/2+n.x,y:t+o.y/2+n.y},i=i*Math.PI/180;s.translate(t.x,t.y),s.rotate(i),s.drawImage(e,0,0,a.x,a.y,-o.x/2,-o.y/2,o.x,o.y),s.rotate(-i),s.translate(-t.x,-t.y)};const f=(e,d)=>{var t=Math.floor(d/90);const i=[...e];for(let e=0;e<t;e++)i.unshift(i.pop());return i};var g=(e,d,t)=>{return f(l[e][d].tile.edges,l[e][d].rotation)[t]},h=()=>{for(let d=r.y-1;d<i.y+r.y+1;d++)for(let e=r.x-1;e<i.x+r.x+1;e++)if(l[d]||(l[d]=Array(i.x)),!l[d][e]){var a=((e,d)=>{const t=[];return t.push(l[d-1]&&l[d-1][e]?g(d-1,e,2):null),t.push(l[d][e+1]?g(d,e+1,3):null),t.push(l[d+1]&&l[d+1][e]?g(d+1,e,0):null),t.push(l[d][e-1]?g(d,e-1,1):null),t})(e,d);if(a.every(e=>null===e))l[d][e]=(t=void 0,{tile:t=TILES[~~(Math.random()*TILES.length)],rotation:90*~~(4*Math.random()),index:~~(Math.random()*t.images.length)});else{const o=[];TILES.forEach(i=>{const e=(t=i.edges,Array(4).fill().map((e,d)=>f(t,90*d)));var t;e.forEach((e,d)=>{var t;t=a,e.every((e,d)=>null===e||null===t[d]||e===t[d])&&o.push({tile:i,rotation:90*d,index:~~(Math.random()*i.images.length)})})}),0<o.length?l[d][e]=o[~~(Math.random()*o.length)]:l[d][e]=null}}var t},u=()=>{for(let d=r.y-1;d<i.y+r.y+1;d++)for(let e=r.x-1;e<i.x+r.x+1;e++)l[d]&&l[d][e]?y(l[d][e].tile.images[l[d][e].index],e*o.x,d*o.y,l[d][e].rotation):console.log("skip for missing tile")};let x=!0,m=!1,v={x:0,y:0};function E(e){var d=e.changedTouches[0],t=document.createEvent("MouseEvent");t.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(t)}e.addEventListener("mousedown",e=>{x||(v={x:e.pageX-n.x,y:e.pageY-n.y},m=!0)}),e.addEventListener("mouseup",()=>{x||(m=!1)}),e.addEventListener("mousemove",e=>{var d;x||m&&(d={x:e.pageX-v.x,y:e.pageY-v.y},n.x=d.x,n.y=d.y,e=-1*Math.ceil(n.x/o.x),d=-1*Math.ceil(n.y/o.y),r.x===e&&r.y===d||(r.x=e,r.y=d,h()),c(),u())}),document.addEventListener("touchstart",E,!0),document.addEventListener("touchmove",E,!0),document.addEventListener("touchend",E,!0),document.addEventListener("touchcancel",E,!0),s.fillStyle="#2572b3",s.fillRect(0,0,e.width,e.height),s.fillStyle="white",s.font="48px Cambria, serif";t=s.measureText("Loading...");s.fillText("Loading...",e.width/2-t.width/2,e.height/2),window.onload=()=>{c(),TILES.forEach(d=>{d.images=[],d.ids.forEach(e=>{e="tile-"+(e<10?"0":"")+e;d.images.push(document.getElementById(e))})}),h(),u(),x=!1}})();